<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic SVG Connections</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
        .header {
            background-color: purple;
            color: white;
            text-align: center;
            padding: 10px;
            font-size: 1.5em;
        }
        .container {
            display: flex;
            position: relative;
        }
        .column {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .sources {
            margin-right: 100px; /* Располагаем destinations на 100px справа */
        }
        .box {
            width: 150px;
            height: 50px;
            border: 1px solid black;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .source {
            background-color: lightgreen;
        }
        .destination {
            background-color: lightblue;
        }
        svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }
    </style>
</head>
<body>
    <div class="header">Название функции<   /div>
    <div class="container" id="diagram-container">
        <div class="column sources" id="sources"></div>
        <svg>
            <defs>
                <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" fill="black" />
                </marker>
            </defs>
        </svg>
        <div class="column destinations" id="destinations"></div>
    </div>

    <script>
        const data = {
            "destination1": ["source1", "source3"],
            "destination2": ["source2"]
        };

        function generateElements(container, data) {
            const sourcesContainer = document.getElementById('sources');
            const destinationsContainer = document.getElementById('destinations');

            // Создаем элементы источников
            const sources = new Set();
            Object.values(data).forEach(sourceList => sourceList.forEach(source => sources.add(source)));

            sources.forEach(id => {
                const div = document.createElement('div');
                div.id = id;
                div.className = 'box source';
                div.textContent = id;
                sourcesContainer.appendChild(div);
            });

            // Создаем элементы целей
            Object.keys(data).forEach(id => {
                const div = document.createElement('div');
                div.id = id;
                div.className = 'box destination';
                div.textContent = id;
                destinationsContainer.appendChild(div);
            });
        }

        function drawArrow(svg, fromElement, toElement) {
            const svgRect = svg.getBoundingClientRect();
            const fromRect = fromElement.getBoundingClientRect();
            const toRect = toElement.getBoundingClientRect();

            // Координаты начальной и конечной точки
            const startX = fromRect.right - svgRect.left;
            const startY = fromRect.top + fromRect.height / 2 - svgRect.top;
            const endX = toRect.left - svgRect.left;
            const endY = toRect.top + toRect.height / 2 - svgRect.top;

            // Создаем линию
            const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
            line.setAttribute("x1", startX);
            line.setAttribute("y1", startY);
            line.setAttribute("x2", endX);
            line.setAttribute("y2", endY);
            line.setAttribute("stroke", "black");
            line.setAttribute("stroke-width", "2");
            line.setAttribute("marker-end", "url(#arrowhead)");
            svg.appendChild(line);
        }

        function drawConnections(svg, data) {
            Object.entries(data).forEach(([to, fromList]) => {
                fromList.forEach(from => {
                    const fromElement = document.getElementById(from);
                    const toElement = document.getElementById(to);

                    if (fromElement && toElement) {
                        drawArrow(svg, fromElement, toElement);
                    } else {
                        console.warn(`Invalid connection: ${from} -> ${to}`);
                    }
                });
            });
        }

        document.addEventListener("DOMContentLoaded", () => {
            const svg = document.querySelector("svg");

            // Генерируем элементы
            generateElements(document.getElementById('diagram-container'), data);

            // Отрисовываем связи
            drawConnections(svg, data);
        });
    </script>
</body>
</html>
